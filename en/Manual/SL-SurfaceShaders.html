<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Writing Surface Shaders</title>
<meta name="description" content="Develop once, publish everywhere! Unity is the ultimate tool for video game development, architectural visualizations, and interactive media installations - publish to the web, Windows, OS X, Wii, Xbox 360, and iPhone with many more platforms to come.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFilesManual/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2854981-1']);
  _gaq.push(['_setDomainName', 'unity3d.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js"></script><script type="text/javascript" src="../StaticFilesManual/js/highlight.js"></script><script type="text/javascript" src="../StaticFilesManual/js/toc_en.js"></script><script>hljs.initHighlightingOnLoad();</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="http://docs.unity3d.com">Overview</a></li>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="http://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content"><div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language: <span class="b">English</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/SL-SurfaceShaders.html">English</a></li>
<li><a href="/es/current/Manual/SL-SurfaceShaders.html">Español</a></li>
<li><a href="/ru/current/Manual/SL-SurfaceShaders.html">Русский</a></li>
</ul></div>
</div></div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Unity Manual</h2></div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManualRestructured.html">Unity Manual</a></li>
<li><a href="Graphics.html">Graphics</a></li>
<li><a href="GraphicsReference.html">Graphics Reference</a></li>
<li><a href="SL-Reference.html">Shader Reference</a></li>
<li>Writing Surface Shaders</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SL-Reference.html"></a></span><div class="tip">Shader Reference</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SL-SurfaceShaderExamples.html"></a></span><div class="tip">Surface Shader Examples</div>
</div>
</div></div>
<h1>Writing Surface Shaders</h1>
  		        <div class="suggest">
                <a class="blue-btn sbtn">Suggest a change</a>
                <div class="suggest-wrap rel hide">
                  <div class="loading hide">
<div></div>
<div></div>
<div></div>
</div>
                  <div class="suggest-success hide">
                    <h2>Success!</h2>
                    <p>Thank you for helping us improve the quality of Unity Documentation. Although we cannot accept all submissions, we do read each suggested change from our users and will make updates where applicable.</p>
                    <a class="gray-btn sbtn close">Close</a>
                  </div>
                  <div class="suggest-failed hide">
                    <h2>Sumbission failed</h2>
                    <p>For some reason your suggested change could not be submitted. Please <a>try again</a> in a few minutes. And thank you for taking the time to help us improve the quality of Unity Documentation.</p>
                    <a class="gray-btn sbtn close">Close</a>
                  </div>
                  <div class="suggest-form clear">
                    <label for="suggest_name">Your name</label>
                    <input id="suggest_name" type="text">
                    <label for="suggest_email">Your email</label>
                    <input id="suggest_email" type="email">
                    <label for="suggest_body" class="clear">Suggestion <span class="r">*</span></label>
                    <textarea id="suggest_body" class="req"></textarea>
                    <button id="suggest_submit" class="blue-btn mr10">Submit suggestion</button>
                    <p class="mb0"><a class="cancel left lh42 cn">Cancel</a></p>
                  </div>
                </div>
              </div>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Writing shaders that interact with lighting is complex. There are different light types, different shadow options, different rendering paths (forward and deferred rendering), and the shader should somehow handle all that complexity.</p>

<p>
<span class="doc-keyword">Surface Shaders</span> in Unity is a code generation approach that makes it much easier to write lit shaders than using low level <a href="SL-ShaderPrograms.html">vertex/pixel shader programs</a>. Note that there is no custom languages, magic or ninjas involved in Surface Shaders; it just generates all the repetitive code that would have to be written by hand. You still write shader code in Cg / HLSL.</p>

<p>For some examples, take a look at <a href="SL-SurfaceShaderExamples.html"><span class="doc-keyword">Surface Shader Examples</span></a> and <a href="SL-SurfaceShaderLightingExamples.html"><span class="doc-keyword">Surface Shader Custom Lighting Examples</span></a>.</p>

<h2>How it works</h2>

<p>You define a “surface function” that takes any UVs or data you need as input, and fills in output structure <code>SurfaceOutput</code>. SurfaceOutput basically describes <em>properties of the surface</em> (it’s albedo color, normal, emission, specularity etc.). You write this code in Cg / HLSL.</p>

<p>Surface Shader compiler then figures out what inputs are needed, what outputs are filled and so on, and generates actual <a href="SL-ShaderPrograms.html">vertex&amp;pixel shaders</a>, as well as rendering passes to handle forward and deferred rendering.</p>

<p>Standard output structure of surface shaders is this:</p>

<pre><code>struct SurfaceOutput {
    half3 Albedo;
    half3 Normal;
    half3 Emission;
    half Specular;
    half Gloss;
    half Alpha;
};
</code></pre>

<h2>Samples</h2>

<p>See <a href="SL-SurfaceShaderExamples.html"><span class="doc-keyword">Surface Shader Examples</span></a>, <a href="SL-SurfaceShaderLightingExamples.html"><span class="doc-keyword">Surface Shader Custom Lighting Examples</span></a> and <a href="SL-SurfaceShaderTessellation.html"><span class="doc-keyword">Surface Shader Tessellation</span></a> pages.</p>

<h2>Surface Shader compile directives</h2>

<p>Surface shader is placed inside <code>CGPROGRAM..ENDCG</code> block, just like any other shader. The differences are:</p>

<ul>
<li>It must be placed inside <a href="SL-SubShader.html">SubShader</a> block, not inside <a href="SL-Pass.html">Pass</a>. Surface shader will compile into multiple passes itself.</li>
<li>It uses <code>#pragma surface ...</code> directive to indicate it’s a surface shader.</li>
</ul>

<p>The <code>#pragma surface</code> directive is:</p>

<pre><code>#pragma surface surfaceFunction lightModel [optionalparams]
</code></pre>

<p>Required parameters:</p>

<ul>
<li>surfaceFunction - which Cg function has surface shader code. The function should have the form of <code>void surf (Input IN, inout SurfaceOutput o)</code>, where Input is a structure you have defined. Input should contain any texture coordinates and extra automatic variables needed by surface function.</li>
<li>lightModel - lighting model to use. Built-in ones are <code>Lambert</code> (diffuse) and <code>BlinnPhong</code> (specular). See <a href="SL-SurfaceShaderLighting.html">Custom Lighting Models</a> page for how to write your own.</li>
</ul>

<p>Optional parameters:</p>

<ul>
<li>
<code>alpha</code> - Alpha blending mode. Use this for semitransparent shaders.</li>
<li>
<code>alphatest:VariableName</code> - Alpha testing mode. Use this for transparent-cutout shaders. Cutoff value is in float variable with VariableName.</li>
<li>
<code>vertex:VertexFunction</code> - Custom vertex modification function. See Tree Bark shader for example.</li>
<li>
<code>finalcolor:ColorFunction</code> - Custom final color modification function. See <a href="SL-SurfaceShaderExamples.html">Surface Shader Examples</a>.</li>
<li>
<code>exclude_path:prepass</code> or <code>exclude_path:forward</code> - Do not generate passes for given rendering path.</li>
<li>
<code>addshadow</code> - Add shadow caster &amp; collector passes. Commonly used with custom vertex modification, so that shadow casting also gets any procedural vertex animation.</li>
<li>
<code>dualforward</code> - Use <a href="LightmappingInDepth.html">dual lightmaps</a> in <a href="RenderTech-ForwardRendering.html">forward</a> rendering path.</li>
<li>
<code>fullforwardshadows</code> - Support all shadow types in <a href="RenderTech-ForwardRendering.html">Forward</a> rendering path.</li>
<li>
<code>decal:add</code> - Additive decal shader (e.g. terrain AddPass).</li>
<li>
<code>decal:blend</code> - Semitransparent decal shader.</li>
<li>
<code>softvegetation</code> - Makes the surface shader only be rendered when Soft Vegetation is on.</li>
<li>
<code>noambient</code> - Do not apply any ambient lighting or spherical harmonics lights.</li>
<li>
<code>novertexlights</code> - Do not apply any spherical harmonics or per-vertex lights in Forward rendering.</li>
<li>
<code>nolightmap</code> - Disables lightmap support in this shader (makes a shader smaller).</li>
<li>
<code>nodirlightmap</code> - Disables directional lightmaps support in this shader (makes a shader smaller).</li>
<li>
<code>noforwardadd</code> - Disables <a href="RenderTech-ForwardRendering.html">Forward</a> rendering additive pass. This makes the shader support one full directional light, with all other lights computed per-vertex/SH. Makes shaders smaller as well.</li>
<li>
<code>approxview</code> - Computes normalized view direction per-vertex instead of per-pixel, for shaders that need it. This is faster, but view direction is not entirely correct when camera gets close to surface.</li>
<li>
<code>halfasview</code> - Pass half-direction vector into the lighting function instead of view-direction. Half-direction will be computed and normalized per vertex. This is faster, but not entirely correct.</li>
<li>
<code>tessellate:TessFunction</code> - use DX11 GPU tessellation; the function computes tessellation factors. See <a href="SL-SurfaceShaderTessellation.html">Surface Shader Tessellation</a> for details.</li>
</ul>

<p>Additionally, you can write <code>#pragma debug</code> inside CGPROGRAM block, and then surface compiler will spit out a lot of comments of the generated code. You can view that using Open Compiled Shader in shader inspector.</p>

<h2>Surface Shader input structure</h2>

<p>The input structure <code>Input</code> generally has any texture coordinates needed by the shader. Texture coordinates must be named “<code>uv</code>” followed by texture name (or start it with “<code>uv2</code>” to use second texture coordinate set).</p>

<p>Additional values that can be put into Input structure:</p>

<ul>
<li>
<code>float3 viewDir</code> - will contain view direction, for computing Parallax effects, rim lighting etc.</li>
<li>
<code>float4</code> with <code>COLOR</code> semantic - will contain interpolated per-vertex color.</li>
<li>
<code>float4 screenPos</code> - will contain screen space position for reflection effects. Used by WetStreet shader in Dark Unity for example.</li>
<li>
<code>float3 worldPos</code> - will contain world space position.</li>
<li>
<code>float3 worldRefl</code> - will contain world reflection vector <em>if surface shader does not write to o.Normal</em>. See Reflect-Diffuse shader for example.</li>
<li>
<code>float3 worldNormal</code> - will contain world normal vector <em>if surface shader does not write to o.Normal</em>.</li>
<li>
<code>float3 worldRefl; INTERNAL_DATA</code> - will contain world reflection vector <em>if surface shader writes to o.Normal</em>. To get the reflection vector based on per-pixel normal map, use <code>WorldReflectionVector (IN, o.Normal)</code>. See Reflect-Bumped shader for example.</li>
<li>
<code>float3 worldNormal; INTERNAL_DATA</code> - will contain world normal vector <em>if surface shader writes to o.Normal</em>. To get the normal vector based on per-pixel normal map, use <code>WorldNormalVector (IN, o.Normal)</code>.</li>
</ul>

<h2>Surface shaders and DirectX 11</h2>

<p>Currently some parts of surface shader compilation pipeline do not understand <a href="DirectX11.html">DirectX 11</a>-specific HLSL syntax, so if you’re using HLSL features like StructuredBuffers, RWTextures and other non-DX9 syntax, you have to wrap it into a DX11-only preprocessor macro. See <a href="SL-PlatformDifferences.html">Platform Specific Differences</a> page for details.</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SL-Reference.html"></a></span><div class="tip">Shader Reference</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SL-SurfaceShaderExamples.html"></a></span><div class="tip">Surface Shader Examples</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2014 Unity Technologies</div>
<div class="menu">
<a href="http://unity3d.com/learn">Learn</a><a href="http://unity3d.com/community">Community</a><a href="http://unity3d.com/asset-store">Asset Store</a><a href="https://store.unity3d.com">Buy</a><a href="http://unity3d.com/unity/download">Download</a>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
